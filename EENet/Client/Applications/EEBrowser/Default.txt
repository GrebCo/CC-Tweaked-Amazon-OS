# <text:cyan>Fizzle Network Demo
<text:lightGray>Interactive demonstration of network capabilities

<hr:"=">

## <text:yellow>1. Send a Message
<text:white>Enter a target hostname or computer ID, then click Send.

<text:lightGray>Target: <textbox width:"15" fg:yellow bg:gray blinkChar:"_" id:"sendTarget" text:"hostname">
<text:lightGray>Message: <textbox width:"25" fg:yellow bg:gray blinkChar:"_" id:"sendMessage" text:"Hello!">
<text:lightGray>Protocol: <textbox width:"10" fg:yellow bg:gray blinkChar:"_" id:"sendProtocol" text:"chat">

<button label:"Send Message" fg:black bg:lime pressBg:green id:"sendBtn" onClick:SendMessage>

<text:gray>Status: <id:"sendStatus"><text:white>Ready

<hr:"-">

## <text:yellow>2. Query a Server
<text:white>Send a request and wait for a response (like an API call).

<text:lightGray>Target: <textbox width:"15" fg:yellow bg:gray blinkChar:"_" id:"queryTarget" text:"server">
<text:lightGray>Query: <textbox width:"25" fg:yellow bg:gray blinkChar:"_" id:"queryMessage" text:"ping">
<text:lightGray>Protocol: <textbox width:"10" fg:yellow bg:gray blinkChar:"_" id:"queryProtocol" text:"api">

<button label:"Send Query" fg:black bg:cyan pressBg:blue id:"queryBtn" onClick:SendQuery>

<text:gray>Response: <id:"queryResponse"><text:white>None yet

<hr:"-">

## <text:yellow>3. Broadcast to Network
<text:white>Send a message to all computers on the network.

<text:lightGray>Broadcast: <textbox width:"30" fg:yellow bg:gray blinkChar:"_" id:"broadcastMsg" text:"Server online!">
<text:lightGray>Protocol: <textbox width:"10" fg:yellow bg:gray blinkChar:"_" id:"broadcastProto" text:"broadcast">

<button label:"Broadcast" fg:black bg:orange pressBg:red id:"broadcastBtn" onClick:BroadcastMessage>

<text:gray>Status: <id:"broadcastStatus"><text:white>Ready

<hr:"-">

## <text:yellow>4. Multi-Target Messenger
<text:white>Send the same message to multiple targets at once.

<text:lightGray>Targets (comma-separated):
<textbox width:"40" fg:yellow bg:gray blinkChar:"_" id:"multiTargets" text:"server1,server2,3">
<text:lightGray>Message: <textbox width:"30" fg:yellow bg:gray blinkChar:"_" id:"multiMessage" text:"Update available">
<text:lightGray>Protocol: <textbox width:"10" fg:yellow bg:gray blinkChar:"_" id:"multiProtocol" text:"notify">

<button label:"Send to All" fg:white bg:purple pressBg:magenta id:"multiBtn" onClick:SendMultiTarget>

<text:gray>Results: <id:"multiStatus"><text:white>Ready

<hr:"-">

## <text:yellow>5. Send by Protocol Lookup
<text:white>Automatically find and message all hosts running a specific protocol.

<text:lightGray>Protocol to lookup: <textbox width:"15" fg:yellow bg:gray blinkChar:"_" id:"lookupProtocol" text:"webserver">
<text:lightGray>Message: <textbox width:"30" fg:yellow bg:gray blinkChar:"_" id:"lookupMessage" text:"ping">
<text:lightGray>Send via protocol: <textbox width:"10" fg:yellow bg:gray blinkChar:"_" id:"lookupMsgProto" text:"http">

<button label:"Find & Send" fg:white bg:blue pressBg:cyan id:"lookupBtn" onClick:SendByProtocolLookup>

<text:gray>Results: <id:"lookupStatus"><text:white>Ready

<hr:"=">

<text:gray>Network Stats: <id:"statsDisplay"><text:white>0 messages sent, 0 queries made

<script>
@onLoad
function initialize()
  -- Set up any initial state
  local stats = document.getElementById("statsDisplay")
  stats.text = "0 messages sent, 0 queries made"
end
</script>

<script>
@SendMessage
function handleSendMessage()
  local targetElem = document.getElementById("sendTarget")
  local messageElem = document.getElementById("sendMessage")
  local protocolElem = document.getElementById("sendProtocol")
  local statusElem = document.getElementById("sendStatus")

  local target = targetElem.text
  local message = messageElem.text
  local protocol = protocolElem.text

  -- Attempt to send the message
  document.setElementBodyById("sendStatus", "Sending...")

  local success = net.send(target, message, protocol)

  if success then
    document.setElementBodyById("sendStatus", "Sent to " .. target .. "!")
  else
    document.setElementBodyById("sendStatus", "Failed to send")
  end
end
</script>

<script>
@SendQuery
function handleSendQuery()
  local targetElem = document.getElementById("queryTarget")
  local messageElem = document.getElementById("queryMessage")
  local protocolElem = document.getElementById("queryProtocol")

  local target = targetElem.text
  local message = messageElem.text
  local protocol = protocolElem.text

  document.setElementBodyById("queryResponse", "Waiting for reply...")

  local response = net.query(target, message, protocol)

  if response then
    document.setElementBodyById("queryResponse", tostring(response))
  else
    document.setElementBodyById("queryResponse", "No response (timeout)")
  end
end
</script>

<script>
@BroadcastMessage
function handleBroadcast()
  local messageElem = document.getElementById("broadcastMsg")
  local protocolElem = document.getElementById("broadcastProto")

  local message = messageElem.text
  local protocol = protocolElem.text

  document.setElementBodyById("broadcastStatus", "Broadcasting...")

  -- Broadcast by sending to ID 65535 (broadcast address in rednet)
  net.send(65535, message, protocol)

  document.setElementBodyById("broadcastStatus", "Broadcast complete!")
end
</script>

<script>
@SendMultiTarget
function handleMultiTarget()
  local targetsElem = document.getElementById("multiTargets")
  local messageElem = document.getElementById("multiMessage")
  local protocolElem = document.getElementById("multiProtocol")

  local targetsStr = targetsElem.text
  local message = messageElem.text
  local protocol = protocolElem.text

  document.setElementBodyById("multiStatus", "Sending to multiple targets...")

  -- Parse comma-separated targets
  local successCount = 0
  local failCount = 0

  for target in string.gmatch(targetsStr, "([^,]+)") do
    -- Trim whitespace
    target = string.match(target, "^%s*(.-)%s*$")

    -- Try to convert to number if it's numeric
    local numTarget = tonumber(target)
    if numTarget then
      target = numTarget
    end

    local success = net.send(target, message, protocol)
    if success then
      successCount = successCount + 1
    else
      failCount = failCount + 1
    end
  end

  local resultMsg = "Sent: " .. successCount .. " | Failed: " .. failCount
  document.setElementBodyById("multiStatus", resultMsg)
end
</script>

<script>
@SendByProtocolLookup
function handleSendByLookup()
  local protocolElem = document.getElementById("lookupProtocol")
  local messageElem = document.getElementById("lookupMessage")
  local msgProtoElem = document.getElementById("lookupMsgProto")

  local protocol = protocolElem.text
  local message = messageElem.text
  local msgProtocol = msgProtoElem.text

  document.setElementBodyById("lookupStatus", "Looking up hosts...")

  -- Use sendByLookup to find and send to all hosts on the protocol
  local result = net.sendByLookup(protocol, message, msgProtocol)

  if result.sent > 0 then
    local idsStr = table.concat(result.ids, ", ")
    local statusMsg = "Sent to " .. result.sent .. " host(s): [" .. idsStr .. "]"
    document.setElementBodyById("lookupStatus", statusMsg)
  else
    document.setElementBodyById("lookupStatus", "No hosts found for protocol '" .. protocol .. "'")
  end
end
</script>
